# soilgrids

<!-- This file is generated by README.qmd; please do not edit by hand -->

This package provides a minimal wrapper for the ISRIC Soilgrids API,
allowing users to query soil properties by latitude/longitude and to
perform basic analyses on the returned data.

Functions:

- `get_soilgrids()`: Provides a simple wrapper for the /properties/query
  API endpoint, parsing the geojson response into a pandas DataFrame.

Classes:

- `SoilGrids()`: Provides methods for reading data from Soilgrids and
  basic including utilities for aggregating and analysing the returned
  data.

Useful links:

- Documentation for the API:
  <https://rest.isric.org/soilgrids/v2.0/docs>
- ISRIC REST entry page, including fair use policy:
  <https://rest.isric.org>
- ISRIC data and software policy:
  <https://www.isric.org/about/data-policy>
- Soilgrids FAQ: <https://www.isric.org/explore/soilgrids/faq-soilgrids>

## Querying data using `SoilGrids`:

The following code reads in the mean values for clay, sand, silt and ocs
(organic carbon stock) in the top 30cm of soil for a random set of 50
points within roughly 25km of [Herning,
Denmark](https://en.wikipedia.org/wiki/Herning). Note that points can be
queried at a maximum rate of 5/minute, so the following code takes about
10 minutes to run:

``` python
from soilgrids import SoilGrids
import pandas as pd

# ~~~ Tweak some settings for cleaner notebook results ~~~ #
import logging
logging.getLogger('soilgrids').setLevel(logging.ERROR)
pd.options.display.notebook_repr_html = False
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

sg = SoilGrids()

sg.get_points_sample(
    3,
    lat_min=56.225297, lat_max=55.958103,
    lon_min=8.662215, lon_max=9.354390,
    soil_property=['clay', 'sand', 'silt', 'ocs'],
    depth=['0-5cm', '5-15cm', '15-30cm', '0-30cm'],
    value='mean'
)

sg.data \
    .filter([
        'lat', 'lon', 'soil_property', 'mapped_units', 
        'target_units', 'depth', 'mean'
    ])
```

             lat       lon soil_property mapped_units target_units    depth  mean
    0  56.271260  8.922771          clay         g/kg            %    0-5cm    61
    1  56.271260  8.922771          clay         g/kg            %   5-15cm    52
    2  56.271260  8.922771          clay         g/kg            %  15-30cm    68
    3  56.271260  8.922771           ocs         t/ha        kg/m²   0-30cm    57
    4  56.271260  8.922771          sand         g/kg            %    0-5cm   832
    5  56.271260  8.922771          sand         g/kg            %   5-15cm   842
    6  56.271260  8.922771          sand         g/kg            %  15-30cm   819
    7  56.271260  8.922771          silt         g/kg            %    0-5cm   106
    8  56.271260  8.922771          silt         g/kg            %   5-15cm   106
    9  56.271260  8.922771          silt         g/kg            %  15-30cm   113
    0  56.281484  8.766259          clay         g/kg            %    0-5cm    60
    1  56.281484  8.766259          clay         g/kg            %   5-15cm    56
    2  56.281484  8.766259          clay         g/kg            %  15-30cm    69
    3  56.281484  8.766259           ocs         t/ha        kg/m²   0-30cm    73
    4  56.281484  8.766259          sand         g/kg            %    0-5cm   795
    5  56.281484  8.766259          sand         g/kg            %   5-15cm   804
    6  56.281484  8.766259          sand         g/kg            %  15-30cm   797
    7  56.281484  8.766259          silt         g/kg            %    0-5cm   145
    8  56.281484  8.766259          silt         g/kg            %   5-15cm   140
    9  56.281484  8.766259          silt         g/kg            %  15-30cm   134
    0  56.360402  8.767026          clay         g/kg            %    0-5cm    52
    1  56.360402  8.767026          clay         g/kg            %   5-15cm    45
    2  56.360402  8.767026          clay         g/kg            %  15-30cm    58
    3  56.360402  8.767026           ocs         t/ha        kg/m²   0-30cm    58
    4  56.360402  8.767026          sand         g/kg            %    0-5cm   832
    5  56.360402  8.767026          sand         g/kg            %   5-15cm   839
    6  56.360402  8.767026          sand         g/kg            %  15-30cm   824
    7  56.360402  8.767026          silt         g/kg            %    0-5cm   116
    8  56.360402  8.767026          silt         g/kg            %   5-15cm   116
    9  56.360402  8.767026          silt         g/kg            %  15-30cm   119

## Get the property (clay, sand, silt) with the highest value for each point

The `SoilGrids` class provides a handy utility `main_properties()` for
finding the most abundant soil type (i.e. property) for each point. In
this case, we see that the Herning region is quite sandy:

``` python
sg.main_properties()
```

             lat       lon soil_property
    0  56.271260  8.922771          sand
    1  56.281484  8.766259          sand
    2  56.360402  8.767026          sand

## Relationship between clay, sand, silt and organic carbon stock

The `ocs_correlation()` method fits and displays summary statistics for
a linear model using sand, clay and silt as predictors and OCS as the
response variable. In this case, we find these soil properties are quite
effective at predicting OCS, explaining around 90% of the variance:

``` python
print(sg.ocs_correlation(capture_output=True))
```

## Disclaimers

- Use of this package is subject to [ISRIC data and software
  policy](https://www.isric.org/about/data-policy).
- This package is licensed as [GPL-2](LICENSE).
